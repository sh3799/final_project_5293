---
title: "code"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Import and modify Data

```{r}
library(tidyverse)
library(stringr)
# Omitting rows with NA, parsed date format
res <- read_csv(
  "restaurant_data.csv",
  col_types = cols(
    `INSPECTION DATE` = col_date(format = "%m / %d / %Y"),
    `GRADE DATE` = col_date(format = "%m / %d / %Y"),
    `RECORD DATE` = col_date(format = "%m / %d / %Y")
  )
) %>% na.omit(res)
# replace names that are too long
res$`CUISINE DESCRIPTION` <-
  gsub(
    "Latin \\(Cuban, Dominican, Puerto Rican, South & Central American\\)",
    "Latin",
    res$`CUISINE DESCRIPTION`
  )

res$`CUISINE DESCRIPTION` <-
  gsub(
    "Bottled beverages, including water, sodas, juices, etc.",
    "Bottled beverages",
    res$`CUISINE DESCRIPTION`
  )

# Latest record for same restaurant
res_one <-
  arrange(res, desc(`GRADE DATE`)) %>% distinct(CAMIS, .keep_all = TRUE)
```

cleveland dot plot of cuisine type by borough

```{r}
# not omitting NAs, to include as much restaurants as possible

res_unique <- read_csv("restaurant_data.csv")[, 1:8] %>% distinct()
res_unique$`CUISINE DESCRIPTION` <-
  gsub(
    "Latin \\(Cuban, Dominican, Puerto Rican, South & Central American\\)",
    "Latin",
    res_unique$`CUISINE DESCRIPTION`
  )

res_unique$`CUISINE DESCRIPTION` <-
  gsub(
    "Bottled beverages, including water, sodas, juices, etc.",
    "Bottled beverages",
    res_unique$`CUISINE DESCRIPTION`
  )

res_borough <- res_unique[,c(3,8)] 
res_borough$count <- rep(1,nrow(res_borough))
res_borough_t <- res_borough %>% group_by(`BORO`,`CUISINE DESCRIPTION`) %>% mutate(count=n()) %>% distinct()

ggplot(res_borough_t,aes(x=count,
                  y=fct_reorder2(`CUISINE DESCRIPTION`,BORO=="MANHATTAN",-count),
                  color=BORO)
                  )+  
  geom_point()+ylab("")
```

Exploring cuisine types and geolocations

```{r}
# Subsetting for restaurant near columbia
res_columbia <- filter(res_one,
                       res_one$ZIPCODE == 10025 |
                         res_one$ZIPCODE == 10026 |
                         res_one$ZIPCODE == 10027)
res_columbia_sum <-
  res_columbia %>% group_by(`CUISINE DESCRIPTION`) %>% summarize(total =
                                                                   n()) %>% arrange(desc(total))
# histogram
ggplot(res_columbia_sum) +
  geom_histogram(aes(x = reorder(`CUISINE DESCRIPTION`, total), y = total), stat = "identity") +
  coord_flip()
# cleveland dot plot
ggplot(res_columbia_sum) +
  geom_point(aes(x = reorder(`CUISINE DESCRIPTION`, total), y = total), stat = "identity") +
  coord_flip()
```
# word cloud
```{r}
# Chinese cuisine

library("wordcloud")

Chinese<- filter(res_one, res_one$`CUISINE DESCRIPTION` =="Chinese") %>% distinct(DBA) %>% toString() %>% str_remove_all(",") %>% str_remove_all("\"") %>% str_remove_all("\n")%>% str_remove_all("/")

word.freq.c <- table(strsplit(Chinese, " ")) %>% as.data.frame()
colnames(word.freq.c) <- c("Word","Freq")
wordcloud(word.freq.c$Word,word.freq.c$Freq)

# Japanese

Japanese<- filter(res_one, res_one$`CUISINE DESCRIPTION` =="Japanese") %>% distinct(DBA) %>% toString() %>% str_remove_all(",") %>% str_remove_all("\"") %>% str_remove_all("\n")%>% str_remove_all("/")

word.freq.j <- table(strsplit(Japanese, " ")) %>% as.data.frame()
colnames(word.freq.j) <- c("Word","Freq")
wordcloud(word.freq.j$Word,word.freq.j$Freq)
```
zipcode plots
```{r}
library(choroplethr)
library(choroplethrZip)
# NYC zipmap
res_zip <- res_one %>% group_by(ZIPCODE)%>% summarise(number=n())
colnames(res_zip) <- c("region","value")
nyc_fips <- c(36005, 36047, 36061, 36081, 36085)
zip_choropleth(res_zip,
                county_zoom = nyc_fips,
                title      = "Number of restaurants in New York",
                legend     = "count")

# Manhattan zipmap
res_man_zip <- res_one %>%filter(BORO=="MANHATTAN") %>%group_by(ZIPCODE)%>% summarise(number=n())
colnames(res_man_zip) <- c("region","value")
zip_choropleth(res_man_zip,
                county_zoom = 36061,
                title      = "Number of restaurants in Manhattan",
                legend     = "count")

# Manhattan Chinese zipmap
res_man_ch_zip <- res_one %>%filter(BORO=="MANHATTAN",`CUISINE DESCRIPTION`=="Chinese") %>%group_by(ZIPCODE)%>% summarise(number=n())
colnames(res_man_ch_zip) <- c("region","value")
zip_choropleth(res_man_ch_zip,
                county_zoom = 36061,
                title      = "Number of Chinese restaurants in Manhattan",
                legend     = "count")

               
```

starbucks and shake shack

```{r}
#starbucks
sb <- res_one %>% filter(res_one$DBA == "STARBUCKS")

#shake shack
ss <- res_one %>% filter(res_one$DBA == "SHAKE SHACK")

```

